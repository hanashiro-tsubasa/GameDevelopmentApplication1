#include "RunningState.h"

#include "DxLib.h"
#include "../../Utility/InputControl.h"
#include "../Player.h"

/// <summary>
/// コンストラクタ
/// </summary>
/// <param name="p">プレイヤー情報</param>
RunningState::RunningState(class Player* p)
	:PlayerStateBase(p)
	, old_location(Vector2D(0.0f))
{

}

/// <summary>
/// デストラクタ
/// </summary>
RunningState::~RunningState()
{

}

/// <summary>
/// 初期化処理
/// </summary>
void RunningState::Initialize()
{
	InputControl* input = InputControl::GetInstance();
	if (input->GetKey(KEY_INPUT_A))
	{
		this->player->velocity.x = -2.0f; //ジャンプ力
	}
	else if (input->GetKey(KEY_INPUT_D))
	{
		this->player->velocity.x = 2.0f;
	}
	if (this->player->GetLocation().x <= 0 &&input->GetKey(KEY_INPUT_A) ||
		this->player->GetLocation().x >= 608 &&input->GetKey(KEY_INPUT_D))
	{
		this->player->velocity.x = 0.0f;
	}

}

/// <summary>
/// 終了処理
/// </summary>
void RunningState::Finalize()
{

}

/// <summary>
/// 更新処理
/// </summary>
void RunningState::Update()
{
	// 地面に触れたら
	if (old_location.y == player->GetLocation().y)
		//2
	{
		//左右入力があるなら
		InputControl* input = InputControl::GetInstance();
		if (input->GetKey(KEY_INPUT_A) || input->GetKey(KEY_INPUT_D))
		{
			//移動状態に遷移
			player->SetNextState(ePlayerState::RUN);
		}
		else
		{
			//停止状態に遷移
			player->SetNextState(ePlayerState::IDLE);
		}
	}

	//前回座標の更新
	old_location = player->GetLocation();
}

/// <summary>
/// 描画処理
/// </summary>
void RunningState::Draw() const
{
	//座標情報を整数値に変換
	int x = 0, y = 0;
	player->GetLocation().ToInt(&x, &y);

	//描画
	DrawBox(x, y, x + (int)(player->box_size.x), y + (int)(player->box_size.y),
		GetColor(0, 255, 0), FALSE);
}

/// <summary>
/// 現在のステート情報を取得する
/// </summary>現在のステート情報</returns>
ePlayerState RunningState::GetState() const
{
	return ePlayerState::RUN;
}
